FROM ubuntu:18.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update -y
RUN apt-get install -y \
    apache2 \
    ca-certificates \
    curl \
    iproute2 \
    libapache2-mod-php \
    mysql-client \
    openssh-server \
    php \
    php7.2-mysql \
    sudo \
    vim

RUN rm -r /var/www/html
COPY ./www/html /var/www/html
RUN chmod 777 /var/www/html/uploads

RUN useradd --create-home --no-log-init -s /bin/bash "james"
RUN echo "!!!s6cur3pa55word\n!!!s6cur3pa55word" |passwd -q "james"
RUN echo "james ALL=(ALL) NOPASSWD: /usr/bin/vim" >> /etc/sudoers

RUN echo "{Flag found, can you get root?}" > /home/james/flag.txt
RUN echo "{Root flag found, well done!}" > /root/flag.txt

EXPOSE 80 22

ENTRYPOINT service apache2 start \
    && service ssh start \
    && tail -F /var/log/apache2/error.log
